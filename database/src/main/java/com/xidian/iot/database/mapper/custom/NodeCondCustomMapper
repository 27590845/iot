<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xidian.iot.database.mapper.custom.NodeCondCustomMapper">
    <resultMap id="BaseResultMap" type="com.xidian.iot.database.entity.NodeCond">
        <id column="nc_id" jdbcType="BIGINT" property="ncId"/>
        <result column="na_id" jdbcType="BIGINT" property="naId"/>
        <result column="scene_id" jdbcType="BIGINT" property="sceneId"/>
        <result column="node_id" jdbcType="BIGINT" property="nodeId"/>
        <result column="nt_id" jdbcType="BIGINT" property="ntId"/>
        <result column="nc_op" jdbcType="TINYINT" property="ncOp"/>
        <result column="nc_val" jdbcType="VARCHAR" property="ncVal"/>
        <result column="node_sn" jdbcType="VARCHAR" property="nodeSn"/>
        <result column="scene_sn" jdbcType="VARCHAR" property="sceneSn"/>
        <result column="nc_fit_time" jdbcType="INTEGER" property="ncFitTime"/>
    </resultMap>
    <sql id="Base_Column_List">
        nc_id, na_id, scene_id, node_id, nt_id, nc_op, nc_val, node_sn, scene_sn, nc_fit_time
    </sql>
    <select id="getNodeCondAvl" resultMap="BaseResultMap">
        select nc.* from
        node_cond nc left join (select nt_id, nt_exec, nt_expr form node_trig) as nt on nc.nt_id=nt.nt_id
        where nt.nt_exec=0 and nt.nt_expr>now()
        and nc.scene_sn=#{sceneSn,jdbcType=VARCHAR}
        and nc_node_sn=#{nodeSn,jdbcType=VARCHAR};
    </select>
</mapper>